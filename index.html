<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Caja Virtual - Irvin Prado</title>
  <link rel="icon" href="https://raw.githubusercontent.com/Irvyandl/VirtualAssistance/refs/heads/main/logo.ico" type="image/x-icon" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400&family=Poppins:wght@700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --color-bg: #E8F0F5;
      --color-accent: #2F528F;
      --color-light: #FFFFFF;
      --color-text-dark: #1A1A1A;
      --input-border: #ccc;
      --input-focus-border: #2F528F;
      --button-hover: #1d3b6c;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to bottom right, #F6F8FB, #E8F0F5);
      color: var(--color-text-dark);
      padding: 4rem 2rem;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .container {
      max-width: 700px;
      width: 100%;
      background: var(--color-light);
      padding: 2rem 2.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    h1 {
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      font-size: 2rem;
      margin-bottom: 1.5rem;
      color: var(--color-accent);
      text-align: center;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .item-row {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .autocomplete-container {
      position: relative;
      flex: 1.8;
    }

    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 6px;
      border: 1px solid var(--input-border);
      font-size: 1rem;
      font-family: 'Inter', sans-serif;
    }

    input[type="text"]:focus, input[type="number"]:focus {
      border-color: var(--input-focus-border);
    }

    input[type="number"] {
      max-width: 90px;
      text-align: center;
    }

    .autocomplete-list {
      position: absolute;
      top: 42px;
      left: 0;
      right: 0;
      background: var(--color-light);
      border: 1px solid var(--color-accent);
      border-top: none;
      max-height: 140px;
      overflow-y: auto;
      z-index: 999;
      border-radius: 0 0 6px 6px;
      box-shadow: 0 4px 8px rgba(47,82,143,0.1);
    }

    .autocomplete-item {
      padding: 8px 12px;
      cursor: pointer;
    }

    .autocomplete-item:hover {
      background: var(--color-accent);
      color: var(--color-light);
    }

    table {
      width: 100%;
      margin-top: 1rem;
      border-collapse: collapse;
      font-size: 0.95rem;
    }

    th, td {
      border-bottom: 1px solid #ddd;
      padding: 0.6rem;
      text-align: left;
    }

    .scrollable {
      max-height: 220px;
      overflow-y: auto;
      margin-top: 1rem;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .total-container {
      margin-top: 1rem;
      display: flex;
      justify-content: space-between;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--color-accent);
    }

    button {
      margin-top: 1.5rem;
      background-color: var(--color-accent);
      color: var(--color-light);
      font-weight: 700;
      padding: 1rem 0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      font-family: 'Poppins', sans-serif;
    }

    button:hover {
      background-color: var(--button-hover);
    }

    .mini-button {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      margin-left: auto;
      border-radius: 6px;
    }

    #msg {
      margin-top: 1rem;
      font-weight: 600;
      text-align: center;
      min-height: 24px;
    }

    #msg.error {
      color: #d93025;
    }

    #msg.success {
      color: #188038;
    }

    footer {
      margin-top: 2rem;
      text-align: center;
      color: #888;
      font-size: 0.8rem;
    }

    @media (max-width: 600px) {
      .item-row {
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
        padding: 0;
      }

      .autocomplete-container {
        width: 100%;
        margin-bottom: 0;
      }

      #cantidad {
        width: 140px;
        max-width: 50%;
        text-align: center;
        margin: 0 auto;
        font-size: 16px;
      }

      #agregarBtn,
      .mini-button {
        width: 100%;
        max-width: 300px;
        margin: 0 auto;
        display: block;
        background-color: var(--color-accent);
        color: var(--color-light);
        padding: 0.75rem;
        border-radius: 6px;
        border: none;
        font-weight: bold;
        font-family: 'Poppins', sans-serif;
      }

      .scrollable {
        max-height: 220px;
        overflow-y: auto;
        overscroll-behavior: contain;
        -webkit-overflow-scrolling: touch;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-top: 1rem;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
      }

      form {
        padding: 0;
        background: none;
        box-shadow: none;
      }

      input {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="container">
      <h1>Caja Virtual</h1>
      <form id="ventaForm">
        <div class="item-row">
          <div class="autocomplete-container">
            <input type="text" id="producto" placeholder="Producto" />
            <div class="autocomplete-list" id="list"></div>
          </div>
          <input type="number" id="cantidad" placeholder="Cant." min="1" />
          <button type="button" class="mini-button" onclick="agregarProducto()">Agregar</button>
        </div>

        <div class="scrollable">
          <table id="tablaVenta">
            <thead>
              <tr>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="total-container">
          <div>Total:</div>
          <div id="total">$0.00</div>
        </div>

        <button type="submit">Registrar Venta</button>
        <div id="msg"></div>
      </form>
    </div>
    <footer>
      <p>&copy; 2025. Irvin Prado. Ascende Superious - Busca Cosas Superiores.</p>
    </footer>
  </div>

  <script>
    const productos = [
      { codigo: 1, nombre: "Hamburguesa", precio: 50 },
      { codigo: 2, nombre: "Tacos", precio: 50 },
      { codigo: 3, nombre: "Enchilada", precio: 50 },
      { codigo: 4, nombre: "Repocheta", precio: 50 },
      { codigo: 5, nombre: "Gaseosa", precio: 25 },
      { codigo: 6, nombre: "Hot-Dog", precio: 50 },
      { codigo: 7, nombre: "Fresco", precio: 15 }
    ];

    const nombreACodigo = {};
    const codigoAPrecio = {};
    productos.forEach(p => {
      nombreACodigo[p.nombre.toLowerCase()] = p.codigo;
      codigoAPrecio[p.codigo] = p.precio;
    });

    let venta = [];

    function setupAutocomplete() {
      const input = document.getElementById("producto");
      const list = document.getElementById("list");

      input.addEventListener("input", () => {
        const val = input.value.toLowerCase();
        list.innerHTML = "";
        if (!val) return;

        const filtered = productos.filter(p => p.nombre.toLowerCase().includes(val));
        filtered.forEach(p => {
          const div = document.createElement("div");
          div.className = "autocomplete-item";
          div.textContent = p.nombre;
          div.onclick = () => {
            input.value = p.nombre;
            list.innerHTML = "";
          };
          list.appendChild(div);
        });
      });

      document.addEventListener("click", e => {
        if (e.target !== input) list.innerHTML = "";
      });
    }

    function agregarProducto() {
      const nombre = document.getElementById("producto").value.trim();
      const cantidad = parseInt(document.getElementById("cantidad").value);

      if (!nombre || isNaN(cantidad) || cantidad < 1) return;

      const nombreLower = nombre.toLowerCase();
      const codigo = nombreACodigo[nombreLower];
      const precio = codigoAPrecio[codigo];

      if (!codigo) return;

      const existente = venta.find(p => p.codigo === codigo);
      if (existente) {
        existente.cantidad += cantidad;
      } else {
        venta.push({ codigo, nombre, cantidad, precio });
      }

      document.getElementById("producto").value = "";
      document.getElementById("cantidad").value = "";
      renderTabla();
    }

    function renderTabla() {
      const tbody = document.querySelector("#tablaVenta tbody");
      tbody.innerHTML = "";
      let total = 0;

      venta.forEach(p => {
        const row = document.createElement("tr");
        const subtotal = p.precio * p.cantidad;
        total += subtotal;

        row.innerHTML = `
          <td>${p.nombre}</td>
          <td>${p.cantidad}</td>
          <td>$${p.precio}</td>
          <td>$${subtotal.toFixed(2)}</td>
        `;
        tbody.appendChild(row);
      });

      document.getElementById("total").textContent = "$" + total.toFixed(2);
    }

    document.getElementById("ventaForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const msgEl = document.getElementById("msg");
      msgEl.textContent = "";
      msgEl.className = "";

      if (venta.length === 0) {
        msgEl.textContent = "Agrega al menos un producto.";
        msgEl.className = "error";
        return;
      }

      const vendidos = venta.map(p => ({
        codigo: p.codigo,
        cantidad: p.cantidad
      }));

      const total = venta.reduce((acc, p) => acc + (p.precio * p.cantidad), 0);

      fetch("https://caja-k0wo.onrender.com/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ vendidos, total })
      })
      .then(res => {
        if (!res.ok) throw new Error("Error al registrar venta.");
        return res.json();
      })
      .then(() => {
        msgEl.textContent = "Venta registrada correctamente.";
        msgEl.className = "success";
        venta = [];
        renderTabla();
      })
      .catch(err => {
        msgEl.textContent = err.message;
        msgEl.className = "error";
      });
    });

    setupAutocomplete();

    const cantidadInput = document.getElementById("cantidad");
    if (window.innerWidth <= 600) {
      cantidadInput.placeholder = "Cant.";
    } else {
      cantidadInput.placeholder = "Cantidad";
    }
  </script>
</body>
</html>
